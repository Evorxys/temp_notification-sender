<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Flask Notification App</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
</head>
<body>
    <div class="container">
        <h1>ðŸ“± Flask Notification App</h1>
        <p>Notifications will appear on your Android Chrome browser.</p>
        <button id="manualNotify">Show Notification Now</button>
    </div>

<script>
async function registerServiceWorker() {
    if ('serviceWorker' in navigator) {
        try {
            await navigator.serviceWorker.register('/static/sw.js');
            console.log("âœ… Service Worker registered");
        } catch (error) {
            console.error("Service Worker registration failed:", error);
        }
    } else {
        alert("Service workers are not supported in this browser.");
    }
}

async function requestNotificationPermission() {
    const permission = await Notification.requestPermission();
    console.log("Notification permission:", permission);
    return permission;
}

async function showNotification(title, body) {
    const registration = await navigator.serviceWorker.getRegistration();
    if (registration) {
        registration.showNotification(title, {
            body: body,
            icon: "https://cdn-icons-png.flaticon.com/512/1827/1827370.png",
            vibrate: [200, 100, 200]
        });
    } else {
        alert("No service worker registration found.");
    }
}

document.addEventListener("DOMContentLoaded", async () => {
    await registerServiceWorker();
    const permission = await requestNotificationPermission();

    if (permission === "granted") {
        // Timed notification after 10 seconds
        setTimeout(() => {
            showNotification("â° Timed Notification", "This is your timed alert!");
        }, 10000);
    }

    document.getElementById("manualNotify").addEventListener("click", () => {
        showNotification("ðŸ“¢ Manual Notification", "You clicked the button!");
    });
});
</script>


</body>
</html>
